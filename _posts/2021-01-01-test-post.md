---
title: "post_title_test"
date: 2021-01-01
categories: test
---

# write_test

abcdefghijklmnopqrstuvwxyz

0123456789

[url_test](https://keinohne.github.io/)

```python

import numpy as np

import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers, optimizers, losses


def set_device( device_type='GPU', device_index=0, device_memory='growth' ) :

    # use CPU
    if device_type == 'CPU' :

        # https://www.tensorflow.org/api_docs/python/tf/config/set_visible_devices
        tf.config.set_visible_devices( [], 'GPU' )

    # use GPU
    if device_type == 'GPU' :

        # https://www.tensorflow.org/api_docs/python/tf/config/list_physical_devices
        list_physical_device = tf.config.list_physical_devices( device_type )
        

        # https://www.tensorflow.org/api_docs/python/tf/config/set_visible_devices
        tf.config.set_visible_devices( list_physical_device[ device_index ], device_type )

        # memory : growth
        if device_memory == 'growth' :
            # https://www.tensorflow.org/api_docs/python/tf/config/experimental/set_memory_growth
            tf.config.experimental.set_memory_growth( list_physical_device[ device_index ], True )

        # memory : limit
        elif type( device_memory ) == int :
            # https://www.tensorflow.org/api_docs/python/tf/config/set_logical_device_configuration
            tf.config.set_logical_device_configuration(
                list_physical_device[ device_index ],
                # https://www.tensorflow.org/api_docs/python/tf/config/LogicalDeviceConfiguration
                [ tf.config.LogicalDeviceConfiguration( memory_limit=device_memory ) ]
            )

set_device( 'GPU', 0 )

x = np.random.random( size=(10000,50,2000) )
y = np.random.random( size=(10000,2) )

inputs = keras.Input( shape=x.shape[1:] )

flatten = layers.LSTM( units=1000 )(inputs)

outputs = layers.Dense( units=2, activation='softmax' )(flatten)

model = keras.Model( inputs=inputs, outputs=outputs )
model.summary()

model.compile( optimizer=optimizers.Adam(), loss=losses.MeanSquaredError() )
model.fit( x=x, y=y, batch_size=256, epochs=100 )

```

